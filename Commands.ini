ارتقا سیستم و نصب پیش‌نیازها:
sudo apt update
sudo apt upgrade
sudo apt install python3 python3-pip python3-venv nginx


ایجاد محیط مجازی و نصب Flask و Gunicorn:
python3 -m venv myenv
source myenv/bin/activate
pip install flask gunicorn


ساخت ساختار پروژه:
mkdir -p ~/myproject
cd ~/myproject


ایجاد و ویرایش فایل codesafe.py:
nano codesafe.py
****************************************************

from flask import Flask, request, render_template, redirect, url_for
import os
from encrypt import encrypt
from decrypt import decrypt

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/encrypt', methods=['POST'])
def encrypt_text():
    text = request.form['text']
    encrypted = encrypt(text)
    return render_template('result.html', result=encrypted, title='Encrypted')

@app.route('/decrypt', methods=['POST'])
def decrypt_text():
    text = request.form['text']
    decrypted = decrypt(text)
    return render_template('result.html', result=decrypted, title='Decrypted')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)


****************************************************

ایجاد و ویرایش فایل encrypt.py:
nano encrypt.py
****************************************************

def encrypt(text):
    encrypted = ''
    for char in text:
        encrypted += str(ord(char)) + ' '
    return encrypted.strip()

****************************************************

ایجاد و ویرایش فایل decrypt.py:
nano decrypt.py
****************************************************

def decrypt(encrypted_text):
    decrypted = ''
    for num in encrypted_text.split():
        decrypted += chr(int(num))
    return decrypted

****************************************************

ایجاد دایرکتوری templates:
mkdir templates


ایجاد فایل templates/index.html:
nano templates/index.html

****************************************************

<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Encryption and Decryption</title>
</head>
<body>
    <h1>متن خود را وارد کنید:</h1>
    <form action="/encrypt" method="post">
        <input type="text" name="text" required>
        <input type="submit" value="Encrypt">
    </form>
    <form action="/decrypt" method="post">
        <input type="text" name="text" required>
        <input type="submit" value="Decrypt">
    </form>
</body>
</html>

****************************************************

ایجاد فایل templates/result.html:
nano templates/result.html

****************************************************

<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
</head>
<body>
    <h1>نتیجه:</h1>
    <p>{{ result }}</p>
    <a href="/">بازگشت</a>
</body>
</html>

****************************************************

اجرای اپلیکیشن با Gunicorn:
gunicorn --workers 3 codesafe:app


پیکربندی Nginx برای راه‌اندازی اپلیکیشن Flask:
ایجاد فایل پیکربندی Nginx:
sudo nano /etc/nginx/sites-available/myproject

****************************************************

server {
    listen 80;
    server_name taino.top www.taino.top 37.27.253.117;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


****************************************************

Nginx، صحت پیکربندی را بررسی کنید:
sudo nginx -t


فعال‌سازی پیکربندی Nginx:
sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled #  ممکن است اضافه باشد
sudo systemctl restart nginx


در صورتی که محیط مجازی فعال شود، دوباره Gunicorn را اجرا کنید:

gunicorn --workers 3 codesafe:app

****************************************************

تست دسترسی:
اکنون می‌توانید هر دو آدرس زیر را در مرورگر خود امتحان کنید:

دامنه: http://taino.top

آی‌پی: http://37.27.253.117